<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öõÔ∏è QUANTUM REVOLUTION - Change The World</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Pro Display', -apple-system, sans-serif;
            background: #000;
            color: #0f0;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Matrix effect */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            opacity: 0.1;
            font-family: monospace;
            font-size: 10px;
            line-height: 10px;
            overflow: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        h1 {
            font-size: 4rem;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #0f0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .revolution-message {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 40px;
            color: #00ff00;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .input-section {
            background: rgba(0,255,0,0.05);
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0,255,0,0.3);
        }
        
        .input-section h2 {
            color: #0f0;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        #pdfInput {
            display: none;
        }
        
        .upload-btn {
            width: 100%;
            padding: 20px;
            background: rgba(0,255,0,0.1);
            border: 2px dashed #0f0;
            color: #0f0;
            font-size: 1.2rem;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            margin-bottom: 30px;
        }
        
        .upload-btn:hover {
            background: rgba(0,255,0,0.2);
            transform: scale(1.02);
        }
        
        .field-input {
            width: 100%;
            background: #000;
            border: 1px solid #0f0;
            color: #0f0;
            padding: 15px;
            font-size: 1.1rem;
            font-family: monospace;
            border-radius: 5px;
            min-height: 150px;
            resize: vertical;
        }
        
        .field-input::placeholder {
            color: rgba(0,255,0,0.5);
        }
        
        .field-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0,255,0,0.5);
        }
        
        .help-text {
            margin-top: 10px;
            color: rgba(0,255,0,0.7);
            font-size: 0.9rem;
        }
        
        .example-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .chip {
            background: rgba(0,255,0,0.1);
            border: 1px solid #0f0;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .chip:hover {
            background: rgba(0,255,0,0.3);
            transform: scale(1.05);
        }
        
        .extract-btn {
            width: 100%;
            padding: 20px;
            background: #0f0;
            color: #000;
            border: none;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 10px;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s;
        }
        
        .extract-btn:hover {
            box-shadow: 0 0 30px #0f0;
            transform: translateY(-2px);
        }
        
        .extract-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .output-section {
            background: rgba(0,255,0,0.05);
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0,255,0,0.3);
        }
        
        .output-section h2 {
            color: #0f0;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        #output {
            background: #000;
            border: 1px solid #0f0;
            padding: 20px;
            min-height: 400px;
            font-family: monospace;
            font-size: 1rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #0f0;
            border-radius: 5px;
            overflow-y: auto;
            max-height: 600px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat {
            background: rgba(0,255,0,0.1);
            border: 1px solid #0f0;
            padding: 15px;
            text-align: center;
            border-radius: 5px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #0f0;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: rgba(0,255,0,0.7);
            margin-top: 5px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 3px solid rgba(0,255,0,0.1);
            border-top: 3px solid #0f0;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .export-btn {
            flex: 1;
            padding: 10px;
            background: rgba(0,255,0,0.1);
            border: 1px solid #0f0;
            color: #0f0;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s;
        }
        
        .export-btn:hover {
            background: rgba(0,255,0,0.3);
        }
        
        .pdf-text {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,255,0,0.05);
            border: 1px solid rgba(0,255,0,0.3);
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.85rem;
            color: rgba(0,255,0,0.7);
        }
    </style>
</head>
<body>
    <div class="matrix-bg" id="matrix"></div>
    
    <div class="container">
        <h1>‚öõÔ∏è QUANTUM EXTRACTOR</h1>
        <div class="revolution-message">
            Chiedi SOLO quello che ti serve ‚Üí Ottieni SOLO quello
        </div>
        
        <div class="main-grid">
            <div class="input-section">
                <h2>INPUT</h2>
                
                <input type="file" id="pdfInput" accept=".pdf">
                <button class="upload-btn" onclick="document.getElementById('pdfInput').click()">
                    üìÑ Carica PDF / Documento
                </button>
                
                <textarea 
                    id="fieldInput" 
                    class="field-input"
                    placeholder="Scrivi i campi che vuoi estrarre, uno per riga:

Produttore
Data redazione
Numero revisione
Denominazione legale
Allergeni
Descrizione prodotto

O separa con virgole:
nome, cognome, email, telefono

O in linguaggio naturale:
partita iva e codice fiscale"></textarea>
                
                <div class="help-text">
                    üí° Scrivi ESATTAMENTE i campi che vuoi. Il sistema estrarr√† SOLO quelli.
                </div>
                
                <div class="example-chips">
                    <div class="chip" onclick="setExample('business')">üè¢ Business</div>
                    <div class="chip" onclick="setExample('food')">üçï Alimentare</div>
                    <div class="chip" onclick="setExample('invoice')">üí∞ Fattura</div>
                    <div class="chip" onclick="setExample('person')">üë§ Persona</div>
                    <div class="chip" onclick="setExample('custom')">‚öôÔ∏è Custom</div>
                </div>
                
                <button class="extract-btn" onclick="extractData()" id="extractBtn">
                    üöÄ ESTRAI DATI
                </button>
                
                <div class="pdf-text" id="pdfText">
                    <strong>Testo estratto dal PDF:</strong>
                    <div id="pdfContent"></div>
                </div>
            </div>
            
            <div class="output-section">
                <h2>OUTPUT</h2>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <div>Quantum Processing...</div>
                </div>
                
                <div id="output">// Output apparir√† qui
// SOLO i campi che hai richiesto
// ZERO sprechi
// Pronto per il tuo codice</div>
                
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportJSON()">üìÑ JSON</button>
                    <button class="export-btn" onclick="exportCode()">üíª Code</button>
                    <button class="export-btn" onclick="copyOutput()">üìã Copy</button>
                    <button class="export-btn" onclick="exportAPI()">üîå API</button>
                </div>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="requestedFields">0</div>
                <div class="stat-label">Campi Richiesti</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="extractedFields">0</div>
                <div class="stat-label">Campi Estratti</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="accuracy">0%</div>
                <div class="stat-label">Precisione</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="time">0ms</div>
                <div class="stat-label">Tempo</div>
            </div>
        </div>
    </div>
    
    <script>
        // PDF.js configuration
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        let pdfText = '';
        let extractedData = {};
        
        // Matrix effect
        function createMatrix() {
            const matrix = document.getElementById('matrix');
            const chars = '01';
            let html = '';
            for (let i = 0; i < 5000; i++) {
                html += chars[Math.floor(Math.random() * chars.length)];
                if (i % 100 === 0) html += '<br>';
            }
            matrix.innerHTML = html;
        }
        createMatrix();
        setInterval(createMatrix, 100);
        
        // REVOLUTIONARY QUANTUM EXTRACTOR ENGINE
        class QuantumExtractor {
            constructor() {
                this.pdfText = '';
            }
            
            // Extract text from PDF
            async extractFromPDF(file) {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    let fullText = '';
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        fullText += pageText + '\n';
                    }
                    
                    this.pdfText = fullText;
                    return fullText;
                } catch (error) {
                    console.error('PDF extraction error:', error);
                    // Try as text file
                    return await file.text();
                }
            }
            
            // PRECISION EXTRACTION - ONLY REQUESTED FIELDS
            extract(text, requestedFields) {
                console.log('üéØ REQUESTED FIELDS:', requestedFields);
                const result = {};
                
                // Process each requested field
                requestedFields.forEach(field => {
                    const fieldLower = field.toLowerCase().trim();
                    const fieldKey = this.normalizeFieldName(field);
                    
                    console.log(`üîç Searching for: "${field}" (key: ${fieldKey})`);
                    
                    // ULTRA-PRECISE EXTRACTION PATTERNS
                    const value = this.findFieldValue(text, field);
                    
                    if (value) {
                        result[fieldKey] = value;
                        console.log(`‚úÖ FOUND: ${fieldKey} = ${value}`);
                    } else {
                        console.log(`‚ùå NOT FOUND: ${field}`);
                    }
                });
                
                return result;
            }
            
            // Find field value with multiple strategies
            findFieldValue(text, fieldName) {
                const field = fieldName.trim();
                const fieldLower = field.toLowerCase();
                
                // Strategy 1: Exact match with colon
                let pattern = new RegExp(`${this.escapeRegex(field)}\\s*[:Ôºö]\\s*([^\\n]+)`, 'i');
                let match = text.match(pattern);
                if (match) return match[1].trim();
                
                // Strategy 2: Exact match with space
                pattern = new RegExp(`${this.escapeRegex(field)}\\s+([^\\n:]+)`, 'i');
                match = text.match(pattern);
                if (match && !match[1].toLowerCase().includes(fieldLower)) {
                    return match[1].trim();
                }
                
                // Strategy 3: Line containing the field
                const lines = text.split('\n');
                for (const line of lines) {
                    if (line.toLowerCase().includes(fieldLower)) {
                        // Extract value after field name
                        const afterField = line.substring(
                            line.toLowerCase().indexOf(fieldLower) + field.length
                        ).trim();
                        
                        // Remove common separators
                        const cleaned = afterField.replace(/^[:Ôºö\s]+/, '').trim();
                        if (cleaned && cleaned.length > 0 && cleaned.length < 200) {
                            return cleaned;
                        }
                    }
                }
                
                // Strategy 4: Field in table format (field | value)
                pattern = new RegExp(`${this.escapeRegex(field)}\\s*[\\|\\t]\\s*([^\\|\\n]+)`, 'i');
                match = text.match(pattern);
                if (match) return match[1].trim();
                
                // Strategy 5: Next line after field
                pattern = new RegExp(`${this.escapeRegex(field)}\\s*\\n\\s*([^\\n]+)`, 'i');
                match = text.match(pattern);
                if (match) return match[1].trim();
                
                // Strategy 6: XML/JSON style
                pattern = new RegExp(`["']${this.escapeRegex(field)}["']\\s*[:=]\\s*["']([^"']+)["']`, 'i');
                match = text.match(pattern);
                if (match) return match[1];
                
                // Strategy 7: Look for partial matches (first word)
                const firstWord = field.split(/\s+/)[0];
                if (firstWord.length > 3) {
                    pattern = new RegExp(`\\b${this.escapeRegex(firstWord)}[^:Ôºö]*[:Ôºö]\\s*([^\\n]+)`, 'i');
                    match = text.match(pattern);
                    if (match) return match[1].trim();
                }
                
                return null;
            }
            
            // Normalize field name for use as object key
            normalizeFieldName(field) {
                return field
                    .toLowerCase()
                    .trim()
                    .replace(/\s+/g, '_')
                    .replace(/[^a-z0-9_]/g, '');
            }
            
            // Escape special regex characters
            escapeRegex(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }
            
            // Parse user input to get requested fields
            parseRequestedFields(input) {
                const fields = [];
                
                // Split by newlines first
                const lines = input.split('\n').filter(line => line.trim());
                
                lines.forEach(line => {
                    // Split by commas if present
                    if (line.includes(',')) {
                        const parts = line.split(',');
                        parts.forEach(part => {
                            const cleaned = part.trim();
                            if (cleaned) fields.push(cleaned);
                        });
                    } else {
                        const cleaned = line.trim();
                        if (cleaned) fields.push(cleaned);
                    }
                });
                
                // Remove duplicates
                return [...new Set(fields)];
            }
        }
        
        const extractor = new QuantumExtractor();
        
        // File input handler
        document.getElementById('pdfInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            document.getElementById('loading').classList.add('active');
            
            try {
                pdfText = await extractor.extractFromPDF(file);
                
                // Show extracted text preview
                document.getElementById('pdfContent').textContent = pdfText.substring(0, 500) + '...';
                document.getElementById('pdfText').style.display = 'block';
                
                // Update button
                document.querySelector('.upload-btn').textContent = `‚úÖ ${file.name} caricato`;
                document.querySelector('.upload-btn').style.borderColor = '#0f0';
                
            } catch (error) {
                console.error('Error loading file:', error);
                alert('Errore nel caricamento del file');
            } finally {
                document.getElementById('loading').classList.remove('active');
            }
        });
        
        // Main extraction function
        async function extractData() {
            const fieldInput = document.getElementById('fieldInput').value;
            
            if (!fieldInput.trim()) {
                alert('Inserisci i campi da estrarre!');
                return;
            }
            
            if (!pdfText) {
                alert('Carica prima un documento!');
                return;
            }
            
            const startTime = performance.now();
            document.getElementById('loading').classList.add('active');
            
            // Parse requested fields
            const requestedFields = extractor.parseRequestedFields(fieldInput);
            
            // QUANTUM EXTRACTION - ONLY WHAT YOU ASK FOR!
            extractedData = extractor.extract(pdfText, requestedFields);
            
            const endTime = performance.now();
            const extractionTime = (endTime - startTime).toFixed(0);
            
            // Update stats
            const requested = requestedFields.length;
            const extracted = Object.keys(extractedData).length;
            const accuracy = requested > 0 ? Math.round((extracted / requested) * 100) : 0;
            
            document.getElementById('requestedFields').textContent = requested;
            document.getElementById('extractedFields').textContent = extracted;
            document.getElementById('accuracy').textContent = accuracy + '%';
            document.getElementById('time').textContent = extractionTime + 'ms';
            
            // Show output
            let output = '';
            if (extracted === 0) {
                output = `// ‚ö†Ô∏è Nessun campo trovato
// Verifica che i nomi dei campi corrispondano al documento
// Campi richiesti: ${requestedFields.join(', ')}`;
            } else {
                output = `// ‚úÖ ESTRATTI SOLO I CAMPI RICHIESTI!
// ${extracted} su ${requested} campi trovati
// Tempo: ${extractionTime}ms

const data = ${JSON.stringify(extractedData, null, 2)};

// Usa direttamente nel tuo codice:
${Object.entries(extractedData).map(([key, value]) => 
    `console.log(data.${key}); // "${value}"`
).join('\n')}`;
            }
            
            document.getElementById('output').textContent = output;
            document.getElementById('loading').classList.remove('active');
        }
        
        // Set example fields
        function setExample(type) {
            const examples = {
                business: `Denominazione
Partita IVA
Codice Fiscale
Numero REA
PEC
Sede Legale
Capitale Sociale`,
                food: `Produttore
Data redazione
Numero revisione
Denominazione legale
Allergeni
Descrizione prodotto
Obbligatorio
Dichiarazione nutrizionale
Scadenza
Lotto`,
                invoice: `Numero Fattura
Data Emissione
Importo Imponibile
IVA
Totale
Scadenza Pagamento
IBAN
Metodo Pagamento`,
                person: `Nome
Cognome
Data di nascita
Luogo di nascita
Codice Fiscale
Indirizzo
Email
Telefono`,
                custom: `Campo1
Campo2
Campo3
MioCustomField
altro_campo`
            };
            
            document.getElementById('fieldInput').value = examples[type] || '';
        }
        
        // Export functions
        function exportJSON() {
            if (Object.keys(extractedData).length === 0) return;
            
            const dataStr = JSON.stringify(extractedData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', 'extracted-data.json');
            link.click();
        }
        
        function exportCode() {
            if (Object.keys(extractedData).length === 0) return;
            
            const code = `// Quantum Extracted Data
const extractedData = ${JSON.stringify(extractedData, null, 2)};

// Usage example:
${Object.entries(extractedData).map(([key, value]) => 
    `const ${key} = extractedData.${key}; // "${value}"`
).join('\n')}

// Direct access:
${Object.keys(extractedData).map(key => 
    `console.log(extractedData.${key});`
).join('\n')}`;
            
            navigator.clipboard.writeText(code);
            alert('‚úÖ Codice copiato negli appunti!');
        }
        
        function copyOutput() {
            const output = document.getElementById('output').textContent;
            navigator.clipboard.writeText(output);
            alert('‚úÖ Output copiato!');
        }
        
        function exportAPI() {
            if (Object.keys(extractedData).length === 0) return;
            
            const apiExample = `// API Integration Example
            
fetch('https://your-api.com/endpoint', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify(${JSON.stringify(extractedData, null, 2)})
})
.then(response => response.json())
.then(data => console.log('Success:', data));`;
            
            navigator.clipboard.writeText(apiExample);
            alert('‚úÖ Esempio API copiato!');
        }
    </script>
</body>
</html>