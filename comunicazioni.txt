
=============================================================

📍 BASE URL: https://ateco-lookup.onrender.com

✅ ENDPOINT ATTIVO - CALCOLA MATRICE DI RISCHIO
------------------------------------------------
POST /calculate-risk-assessment

Invia:
{
  "economic_loss": "G",          // G/Y/O/R - Perdita economica attesa
  "non_economic_loss": "G",      // G/Y/O/R - Perdita non economica 
  "control_level": "+"           // ++/+/-/-- - Livello di controllo
}

Ricevi:
{
  "status": "success",
  "matrix_position": "B3",       // Posizione nella matrice (A1-D4)
  "risk_level": "Medium",        // Low/Medium/High/Critical
  "risk_color": "yellow",        // green/yellow/orange/red
  "risk_value": 0,               // 0 o 1 (per compatibilità Excel)
  "inherent_risk": {
    "value": 3,                  // Valore numerico (1-4)
    "label": "Medium"            // Etichetta testuale
  },
  "control_effectiveness": {
    "value": 3,                  // Riga nella matrice (1-4)
    "label": "+",                // Simbolo controllo
    "description": "Sostanzialmente adeguato"
  },
  "calculation_details": {       // Dettagli del calcolo
    "economic_loss": "Y",
    "economic_value": 3,
    "non_economic_loss": "G", 
    "non_economic_value": 4,
    "min_value": 3,              // MIN(economic, non_economic)
    "control_level": "+",
    "control_row": 3,
    "matrix_column": "B"
  },
  "recommendations": [           // Raccomandazioni basate sul livello
    "Monitorare regolarmente",
    "Valutare opportunità di miglioramento controlli",
    "Documentare piani di contingenza"
  ]
}

🎯 LOGICA DI CALCOLO
--------------------
1. Converti colori in valori: G=4, Y=3, O=2, R=1
2. Rischio Inerente = MIN(economic_value, non_economic_value)
3. Controllo determina la riga: ++=4, +=3, -=2, --=1
4. Colonna dalla formula: 6 - rischio_inerente (A=4, B=3, C=2, D=1)
5. Posizione = Colonna + Riga (es. "B3")

📊 MATRICE 4x4 RISULTANTE
-------------------------
       A      B      C      D
4  | Low  | Low  | Med  | High |  ++ Adeguato
3  | Low  | Med  | High | Crit |  + Sostanzialmente
2  | Med  | High | Crit | Crit |  - Parzialmente  
1  | High | Crit | Crit | Crit |  -- Non adeguato

🔥 TUTTE LE 64 COMBINAZIONI POSSIBILI
--------------------------------------
Ci sono 4×4×4 = 64 combinazioni possibili:
- 4 valori per economic_loss (G/Y/O/R)
- 4 valori per non_economic_loss (G/Y/O/R) 
- 4 valori per control_level (++/+/-/--)

Ogni combinazione produce una posizione unica nella matrice!

📝 ALTRI ENDPOINT DISPONIBILI
-----------------------------
GET /risk-assessment-fields - Struttura campi di valutazione
POST /save-risk-assessment - Salva valutazione e calcola score
GET /events/{category} - Eventi per categoria
GET /description/{event_code} - Descrizione evento

⚠️ IMPORTANTE
-------------
- Il backend è su Render, può avere latenza iniziale
- Usa sempre CORS headers per le chiamate cross-origin
- Il calcolo segue ESATTAMENTE la logica Excel originale
- La matrice di rischio replica il foglio "rischi oggettivi finanziari"

🎯 ESEMPIO CHIAMATA COMPLETA
----------------------------
fetch('https://ateco-lookup.onrender.com/calculate-risk-assessment', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    economic_loss: 'Y',
    non_economic_loss: 'O',
    control_level: '+'
  })
})
.then(res => res.json())
.then(data => {
  console.log('Posizione:', data.matrix_position);  // "C3"
  console.log('Livello:', data.risk_level);          // "High"
  console.log('Colore:', data.risk_color);           // "orange"
});

✅ ENDPOINT RISOLTO - NON PIÙ 404!