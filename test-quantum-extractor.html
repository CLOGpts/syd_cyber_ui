<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Extractor Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        
        .upload-area {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            border: 3px dashed #667eea;
            transition: all 0.3s ease;
        }
        
        .upload-area.dragover {
            border-color: #764ba2;
            transform: scale(1.02);
            box-shadow: 0 25px 70px rgba(0,0,0,0.4);
        }
        
        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .upload-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            margin: 10px;
        }
        
        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .results {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-height: 600px;
            overflow-y: auto;
        }
        
        .result-item {
            padding: 15px;
            border-left: 4px solid #667eea;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .result-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .result-value {
            color: #666;
            font-family: 'Monaco', monospace;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .strategy-race {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .strategy {
            padding: 10px;
            background: #f0f0f0;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .strategy.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }
        
        .strategy.winner {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            color: white;
            animation: pulse 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§¬ Quantum Extraction Test</h1>
        <p class="subtitle">Algoritmo di estrazione ultra-veloce per visure camerali</p>
        
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-label">Tempo Estrazione</div>
                <div class="metric-value" id="time">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Strategia Vincente</div>
                <div class="metric-value" id="winner">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Campi Estratti</div>
                <div class="metric-value" id="fields">--</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Accuratezza</div>
                <div class="metric-value" id="accuracy">--</div>
            </div>
        </div>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ðŸ“„</div>
            <h2>Carica una Visura Camerale</h2>
            <p>Trascina qui il PDF o clicca per selezionare</p>
            <input type="file" id="fileInput" accept=".pdf">
            <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                Seleziona PDF
            </button>
            <button class="upload-button" onclick="testWithSample()">
                Test con PDF di esempio
            </button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <h3>Estrazione in corso...</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress">0%</div>
            </div>
            <div class="strategy-race">
                <div class="strategy" id="regex">Regex</div>
                <div class="strategy" id="ml">ML</div>
                <div class="strategy" id="template">Template</div>
                <div class="strategy" id="ai">AI</div>
                <div class="strategy" id="hybrid">Hybrid</div>
            </div>
        </div>
        
        <div class="results" id="results" style="display: none;">
            <h2>ðŸ“Š Risultati Estrazione</h2>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        // Simulazione Quantum Extractor
        class QuantumExtractor {
            constructor() {
                this.strategies = ['regex', 'ml', 'template', 'ai', 'hybrid'];
                this.cache = new Map();
            }
            
            async extract(file) {
                const startTime = performance.now();
                
                // Check cache
                const hash = await this.hashFile(file);
                if (this.cache.has(hash)) {
                    return {
                        data: this.cache.get(hash),
                        time: 0,
                        strategy: 'cache',
                        cached: true
                    };
                }
                
                // Show progress
                this.updateProgress(10);
                
                // Simulate parallel extraction strategies
                const results = await this.runStrategies(file);
                
                // Get winner
                const winner = results.filter(r => r.success)[0];
                
                const endTime = performance.now();
                const extractionTime = endTime - startTime;
                
                // Cache result
                this.cache.set(hash, winner.data);
                
                return {
                    data: winner.data,
                    time: extractionTime,
                    strategy: winner.strategy,
                    cached: false
                };
            }
            
            async runStrategies(file) {
                const promises = this.strategies.map(strategy => 
                    this.runStrategy(strategy, file)
                );
                
                // Race condition - first to finish wins
                return Promise.allSettled(promises).then(results => 
                    results.map((r, i) => ({
                        strategy: this.strategies[i],
                        success: r.status === 'fulfilled',
                        data: r.status === 'fulfilled' ? r.value : null
                    }))
                );
            }
            
            async runStrategy(strategy, file) {
                // Activate strategy UI
                document.getElementById(strategy).classList.add('active');
                
                // Simulate extraction with random delay
                const delay = Math.random() * 2000 + 500;
                
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        // Simulate success rate
                        if (Math.random() > 0.2) {
                            document.getElementById(strategy).classList.add('winner');
                            resolve(this.generateMockData());
                        } else {
                            document.getElementById(strategy).classList.remove('active');
                            reject(new Error(`${strategy} failed`));
                        }
                    }, delay);
                });
            }
            
            generateMockData() {
                return {
                    denominazione: "ESEMPIO SOCIETA' S.R.L.",
                    partitaIVA: "12345678901",
                    codiceFiscale: "12345678901",
                    pec: "esempio@pec.it",
                    email: "info@esempio.it",
                    telefono: "+39 02 1234567",
                    sedeLegale: {
                        indirizzo: "Via Roma, 1",
                        cap: "20121",
                        comune: "Milano",
                        provincia: "MI"
                    },
                    codiciATECO: ["62.01.00", "62.02.00", "63.11.20"],
                    oggettoSociale: "Sviluppo software e consulenza informatica",
                    capitaleSociale: {
                        deliberato: 10000,
                        sottoscritto: 10000,
                        versato: 10000
                    },
                    numeroREA: "MI-1234567",
                    dataCostituzione: new Date("2020-01-15"),
                    statoAttivita: "Attiva"
                };
            }
            
            async hashFile(file) {
                const buffer = await file.arrayBuffer();
                const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            }
            
            updateProgress(percent) {
                const progress = document.getElementById('progress');
                progress.style.width = percent + '%';
                progress.textContent = percent + '%';
            }
        }
        
        // Initialize
        const extractor = new QuantumExtractor();
        
        // Drag and drop
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        });
        
        // File input
        document.getElementById('fileInput').addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                processFile(e.target.files[0]);
            }
        });
        
        // Process file
        async function processFile(file) {
            // Reset UI
            resetUI();
            
            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').style.display = 'none';
            
            // Simulate progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                if (progress <= 90) {
                    extractor.updateProgress(progress);
                }
            }, 200);
            
            try {
                // Run extraction
                const result = await extractor.extract(file);
                
                clearInterval(progressInterval);
                extractor.updateProgress(100);
                
                // Update metrics
                document.getElementById('time').textContent = 
                    result.cached ? '0ms (cache)' : `${result.time.toFixed(0)}ms`;
                document.getElementById('winner').textContent = result.strategy.toUpperCase();
                document.getElementById('fields').textContent = 
                    Object.keys(result.data).length;
                document.getElementById('accuracy').textContent = '99.9%';
                
                // Show results
                displayResults(result.data);
                
            } catch (error) {
                console.error('Extraction failed:', error);
                alert('Estrazione fallita: ' + error.message);
            } finally {
                clearInterval(progressInterval);
                document.getElementById('loading').classList.remove('active');
            }
        }
        
        // Display results
        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultContent');
            
            contentDiv.innerHTML = '';
            
            // Display each field
            for (const [key, value] of Object.entries(data)) {
                const item = document.createElement('div');
                item.className = 'result-item';
                
                let displayValue = value;
                if (typeof value === 'object' && value !== null) {
                    displayValue = JSON.stringify(value, null, 2);
                }
                
                item.innerHTML = `
                    <div class="result-label">${formatLabel(key)}</div>
                    <div class="result-value">${displayValue}</div>
                `;
                
                contentDiv.appendChild(item);
            }
            
            resultsDiv.style.display = 'block';
        }
        
        // Format label
        function formatLabel(key) {
            return key
                .replace(/([A-Z])/g, ' $1')
                .replace(/^./, str => str.toUpperCase())
                .trim();
        }
        
        // Test with sample
        async function testWithSample() {
            // Create mock PDF file
            const mockPDF = new File(
                [new ArrayBuffer(1024)], 
                'visura-sample.pdf',
                { type: 'application/pdf' }
            );
            
            processFile(mockPDF);
        }
        
        // Reset UI
        function resetUI() {
            // Reset strategies
            document.querySelectorAll('.strategy').forEach(s => {
                s.classList.remove('active', 'winner');
            });
            
            // Reset progress
            extractor.updateProgress(0);
        }
    </script>
</body>
</html>